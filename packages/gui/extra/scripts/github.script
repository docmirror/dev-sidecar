// ==UserScript==
// @name         Github å¢å¼º - é«˜é€Ÿä¸‹è½½
// @version      1.6.8
// @author       X.I.U
// @description  é«˜é€Ÿä¸‹è½½ Git Clone/SSHã€Releaseã€Rawã€Code(ZIP) ç­‰æ–‡ä»¶ã€é¡¹ç›®åˆ—è¡¨å•æ–‡ä»¶å¿«æ·ä¸‹è½½ (â˜)
// @match        *://github.com/*
// @match        *://hub.fastgit.org/*
// @icon         https://i.loli.net/2021/03/30/ULV9XunaHesqGIR.png
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_openInTab
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_notification
// @license      GPL-3.0 License
// @run-at       document-end
// @namespace    https://greasyfork.org/scripts/412245
// @supportURL   https://github.com/XIU2/UserScript
// @homepageURL  https://github.com/XIU2/UserScript
// ==/UserScript==

(function() {
    'use strict';
    var backColor = '#ffffff', fontColor = '#888888';
    if (document.getElementsByTagName('html')[0].getAttribute('data-color-mode') === 'dark') { // é»‘æš—æ¨¡å¼åˆ¤æ–­
        if (document.getElementsByTagName('html')[0].getAttribute('data-dark-theme') === 'dark_dimmed') {
            backColor = '#272e37'; fontColor = '#768390';
        } else {
            backColor = '#161a21'; fontColor = '#97a0aa';
        }
    } else if (document.getElementsByTagName('html')[0].getAttribute('data-color-mode') === 'auto') {
        if (window.getComputedStyle(document.body).backgroundColor === 'rgb(34, 39, 46)') {
            backColor = '#272e37'; fontColor = '#768390';
        } else if (window.getComputedStyle(document.body).backgroundColor === 'rgb(13, 17, 23)') {
            backColor = '#161a21'; fontColor = '#97a0aa';
        }
    }
    const download_url = [
        ['https://gh.api.99988866.xyz/https://github.com', 'ç¾å›½ 1'],
        ['https://github.91chifun.workers.dev/https://github.com', 'ç¾å›½ 2'],
        ['https://gh.xiu2.xyz/https://github.com', 'ç¾å›½ 3'],
        ['https://github.rc1844.workers.dev', 'ç¾å›½ 4'],
        ['https://pd.zwc365.com/seturl/https://github.com', 'ç¾å›½ 5'],
        ['https://download.fastgit.org', 'æ—¥æœ¬'],
        ['https://ghproxy.com/https://github.com/', 'éŸ©å›½']
    ],
        clone_url = [
            ['https://hub.fastgit.org', 'ä¸­å›½é¦™æ¸¯'],
            ['https://gitclone.com', 'ä¸­å›½æµ™æ±Ÿ'],
            ['https://github.com.cnpmjs.org', 'æ–°åŠ å¡']
        ],
        clone_ssh_url = [
            ['git@git.zhlh6.cn', 'ä¸­å›½åŒ—äº¬'],
            ['git@hub.fastgit.org', 'ä¸­å›½é¦™æ¸¯']
        ],
        raw_url = [
            ['https://raw.githubusercontent.com', 'Github åŸç”Ÿ',''],
            ['https://cdn.jsdelivr.net','ä¸­å›½å›½å†…', 'æ³¨æ„ï¼šè¯¥åŠ é€Ÿæºå­˜åœ¨ç¼“å­˜æœºåˆ¶ï¼ˆ24å°æ—¶ï¼‰ï¼Œæ‰€ä»¥æ–‡ä»¶å¯èƒ½ä¸æ˜¯æœ€æ–°ã€‚&#10;æ³¨æ„ï¼šå½“å‰åˆ†æ”¯æ‰€æœ‰æ–‡ä»¶æ€»æ–‡ä»¶å¤§å°è¶…è¿‡ 50MB æ—¶ï¼Œè¯¥åŠ é€Ÿæºä¸å¯ç”¨ã€‚&#10;æ³¨æ„ï¼šå½“å‰åˆ†æ”¯åä¸ºç‰ˆæœ¬å·æ ¼å¼æ—¶ï¼ˆå¦‚ v1.2.3ï¼‰ï¼Œè¯¥é«˜é€Ÿä¸‹è½½é“¾æ¥å› æ ¼å¼é™åˆ¶ä¸å¯ç”¨ã€‚'],
            ['https://raw.fastgit.org','ä¸­å›½é¦™æ¸¯', 'æ³¨æ„ï¼šå•ä¸ªæ–‡ä»¶å¤ªå¤§æ—¶å¯èƒ½ä¼šæç¤ºè¶…æ—¶ï¼ˆå®æ—¶è·å–ä¸­ï¼‰ï¼Œè¯·é‡è¯•ã€‚'],
            ['https://cdn.staticaly.com','æ—¥æœ¬ä¸œäº¬', 'æ³¨æ„ï¼šè¯¥åŠ é€Ÿæ˜¯å…¨çƒ Anycast CDNï¼Œå›½å†…ä¸€èˆ¬åˆ†é…åˆ°æ—¥æœ¬èŠ‚ç‚¹ã€‚']
        ],
        svg = [
            '<svg class="octicon octicon-file-zip mr-2" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M3.5 1.75a.25.25 0 01.25-.25h3a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h2.086a.25.25 0 01.177.073l2.914 2.914a.25.25 0 01.073.177v8.586a.25.25 0 01-.25.25h-.5a.75.75 0 000 1.5h.5A1.75 1.75 0 0014 13.25V4.664c0-.464-.184-.909-.513-1.237L10.573.513A1.75 1.75 0 009.336 0H3.75A1.75 1.75 0 002 1.75v11.5c0 .649.353 1.214.874 1.515a.75.75 0 10.752-1.298.25.25 0 01-.126-.217V1.75zM8.75 3a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h-.5zM6 5.25a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5A.75.75 0 016 5.25zm2 1.5A.75.75 0 018.75 6h.5a.75.75 0 010 1.5h-.5A.75.75 0 018 6.75zm-1.25.75a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h-.5zM8 9.75A.75.75 0 018.75 9h.5a.75.75 0 010 1.5h-.5A.75.75 0 018 9.75zm-.75.75a1.75 1.75 0 00-1.75 1.75v3c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75v-3a1.75 1.75 0 00-1.75-1.75h-.5zM7 12.25a.25.25 0 01.25-.25h.5a.25.25 0 01.25.25v2.25H7v-2.25z"></path></svg>',
            '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-paste js-clipboard-clippy-icon d-inline-block"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg><svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-text-success d-inline-block d-sm-none"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>',
            '<svg class="octicon octicon-cloud-download" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M9 12h2l-3 3-3-3h2V7h2v5zm3-8c0-.44-.91-3-4.5-3C5.08 1 3 2.92 3 5 1.02 5 0 6.52 0 8c0 1.53 1 3 3 3h3V9.7H3C1.38 9.7 1.3 8.28 1.3 8c0-.17.05-1.7 1.7-1.7h1.3V5c0-1.39 1.56-2.7 3.2-2.7 2.55 0 3.13 1.55 3.2 1.8v1.2H12c.81 0 2.7.22 2.7 2.2 0 2.09-2.25 2.2-2.7 2.2h-2V11h2c2.08 0 4-1.16 4-3.5C16 5.06 14.08 4 12 4z"></path></svg>'
        ],
        style = ['padding:0 6px;margin-right: -1px;border-radius: 2px;background-color: '+backColor+';border-color: rgba(27, 31, 35, 0.1);font-size: 11px;color: '+fontColor+';'];
        var menu_raw_fast = GM_getValue('xiu2_menu_raw_fast'), menu_menu_raw_fast_ID, menu_feedBack_ID;
    if (menu_raw_fast == null){menu_raw_fast = 1; GM_setValue('xiu2_menu_raw_fast', 1)};

    registerMenuCommand();
    // æ³¨å†Œè„šæœ¬èœå•
    function registerMenuCommand() {
        if (menu_feedBack_ID) { // å¦‚æœåé¦ˆèœå•IDä¸æ˜¯ nullï¼Œåˆ™åˆ é™¤æ‰€æœ‰è„šæœ¬èœå•
            GM_unregisterMenuCommand(menu_menu_raw_fast_ID);
            GM_unregisterMenuCommand(menu_feedBack_ID);
            menu_raw_fast = GM_getValue('xiu2_menu_raw_fast');
        }
        if (menu_raw_fast > raw_url.length - 1) { // é¿å…åœ¨å‡å°‘ raw æ•°ç»„åï¼Œç”¨æˆ·å‚¨å­˜çš„æ•°æ®å¤§äºæ•°ç»„è€ŒæŠ¥é”™
            menu_raw_fast = 0
        }
        menu_menu_raw_fast_ID = GM_registerMenuCommand(`${menu_num(menu_raw_fast)} [ ${raw_url[menu_raw_fast][1]} ] åŠ é€Ÿæº (â˜) - ç‚¹å‡»åˆ‡æ¢`, menu_toggle_raw_fast);
        menu_feedBack_ID = GM_registerMenuCommand('ğŸ’¬ åé¦ˆ & å»ºè®® [Github]', function () {window.GM_openInTab('https://github.com/XIU2/UserScript', {active: true,insert: true,setParent: true});window.GM_openInTab('https://greasyfork.org/zh-CN/scripts/412245/feedback', {active: true,insert: true,setParent: true});});
    }

    // åˆ‡æ¢åŠ é€Ÿæº
    function menu_toggle_raw_fast() {
        if (menu_raw_fast >= raw_url.length - 1) { // å¦‚æœå½“å‰åŠ é€Ÿæºä½ç½®å¤§äºç­‰äºåŠ é€Ÿæºæ€»æ•°ï¼Œåˆ™æ”¹ä¸ºç¬¬ä¸€ä¸ªåŠ é€Ÿæºï¼Œåä¹‹é€’å¢ä¸‹ä¸€ä¸ªåŠ é€Ÿæº
            menu_raw_fast = 0;
        } else {
            menu_raw_fast += 1;
        }
        GM_setValue('xiu2_menu_raw_fast', menu_raw_fast);
        delRawDownLink(); // åˆ é™¤æ—§åŠ é€Ÿæº
        addRawDownLink(); // æ·»åŠ æ–°åŠ é€Ÿæº
        GM_notification({text: "å·²åˆ‡æ¢åŠ é€Ÿæºä¸ºï¼š" + raw_url[menu_raw_fast][1], timeout: 3000}); // æç¤ºæ¶ˆæ¯
        registerMenuCommand(); // é‡æ–°æ³¨å†Œè„šæœ¬èœå•
    };

    // èœå•æ•°å­—å›¾æ ‡
    function menu_num(num) {
        return ['0ï¸âƒ£','1ï¸âƒ£','2ï¸âƒ£','3ï¸âƒ£','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£','7ï¸âƒ£','8ï¸âƒ£','9ï¸âƒ£','ğŸ”Ÿ'][num]
    }

    addRelease(); //                     Release åŠ é€Ÿ
    setTimeout(addDownloadZIP, 2000); // Download ZIP åŠ é€Ÿ
    setTimeout(addGitClone, 2000); //    Git Clone åŠ é€Ÿ
    setTimeout(addGitCloneSSH, 2000); // Git Clone SSH åŠ é€Ÿ
    addRawFile(); //                     Raw åŠ é€Ÿ
    setTimeout(addRawDownLink, 2000); // æ·»åŠ  Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰ï¼Œå»¶è¿Ÿ 2 ç§’æ‰§è¡Œï¼Œé¿å…è¢« pjax åˆ·æ‰

    document.addEventListener('pjax:success',function(){ // pjax äº‹ä»¶å‘ç”Ÿå
        addRelease(); //                     Release åŠ é€Ÿ
        setTimeout(addDownloadZIP, 2000); // Download ZIP åŠ é€Ÿ
        setTimeout(addGitClone, 2000); //    Git Clone åŠ é€Ÿ
        setTimeout(addGitCloneSSH, 2000); // Git Clone SSH åŠ é€Ÿ
        addRawFile(); //                     Raw åŠ é€Ÿ
        setTimeout(addRawDownLink, 2000); // æ·»åŠ  Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰ï¼Œå»¶è¿Ÿ 2 ç§’æ‰§è¡Œï¼Œé¿å…è¢« pjax åˆ·æ‰
    });

    addLocationchange();
    window.addEventListener('locationchange', function(){
        addRawDownLink_(); // åœ¨æµè§ˆå™¨è¿”å›/å‰è¿›æ—¶é‡æ–°æ·»åŠ  Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰äº‹ä»¶
    })


    // Release
    function addRelease() {
        let html = document.getElementsByClassName('Box-footer'); if (html.length == 0) return
        let divDisplay = '';
        if (document.documentElement.clientWidth > 1000) {divDisplay = 'float: right;margin-top: -3px;margin-left: 8px;';}; // è°ƒæ•´å°å±å¹•æ—¶çš„æ ·å¼
        Array.from(html).forEach(function (current) {
            current.querySelectorAll('li.Box-row > a').forEach(function (_this) {
                let href = _this.href.split(location.host),
                    url = [],
                    _html = `<div style="${divDisplay}">`;
                // å¾ªç¯ç»„åˆ URL é“¾æ¥
                for (let i=0;i<download_url.length;i++){
                    url[i] = download_url[i][0] + href[1]
                    if (location.host === 'hub.fastgit.org') url[i] = url[i].replace('hub.fastgit.org','github.com')
                    if (download_url[i][0] === 'https://download.fastgit.org' && url[i].indexOf('/archive/') > -1) url[i] = url[i].replace('https://download.fastgit.org','https://archive.fastgit.org')
                }
                // å¾ªç¯ç”Ÿæˆ HTML æ ‡ç­¾
                for (let i=0;i<url.length;i++) {
                    _html += `<a style="${style[0]}" class="btn" href="${url[i]}" rel="noreferrer noopener nofollow">${download_url[i][1]}</a>`
                }
                _html += `</div>`
                _this.insertAdjacentHTML('afterend', _html);
            });
        });
    }


    // Download ZIP
    function addDownloadZIP() {
        if (document.querySelector('.XIU2-DZ')) return
        let html = document.querySelector('.dropdown-menu.dropdown-menu-sw.p-0 ul li:last-child');if (!html) return
        let href = html.getElementsByTagName('a')[0].href,
            url = [],
            _html = ``;

        for (let i=0;i<download_url.length;i++){
            url[i] = download_url[i][0] + href.split(location.host)[1]
            if (location.host === 'hub.fastgit.org') url[i] = url[i].replace('hub.fastgit.org','github.com')
            if (download_url[i][0] === 'https://download.fastgit.org' && url[i].indexOf('/archive/') > -1) url[i] = url[i].replace('https://download.fastgit.org','https://archive.fastgit.org')
        }

        for (let i=0;i<url.length;i++) {
            _html += `<li class="Box-row Box-row--hover-gray p-3 mt-0 XIU2-DZ"><a class="d-flex flex-items-center color-text-primary text-bold no-underline" rel="nofollow" href="${url[i]}">${svg[0]}Download ZIP ${download_url[i][1]}</a></li>`
        }
        html.insertAdjacentHTML('afterend', _html);
    }


    // Git Clone
    function addGitClone() {
        if (document.querySelector('.XIU2-GC')) return
        let html = document.querySelector('[role="tabpanel"]:nth-child(2) div.input-group');if (!html) return
        let href_split = html.getElementsByTagName('input')[0].getAttribute('value').split(location.host),
            url = [],
            _html = ``;

        for (let i=0;i<clone_url.length;i++){
            if (clone_url[i][0] === 'https://gitclone.com') {
                url[i] = clone_url[i][0] + '/github.com' + href_split[1]
            } else {
                url[i] = clone_url[i][0] + href_split[1]
            }
        }

        for (let i=0;i<url.length;i++) {
            _html += `<div class="input-group XIU2-GC" style="margin-top: 4px;" title="åŠ é€Ÿæºï¼š${clone_url[i][1]} ï¼ˆç‚¹å‡»å¯ç›´æ¥å¤åˆ¶ï¼‰"><input value="${url[i]}" aria-label="${url[i]}" type="text" class="form-control input-monospace input-sm color-bg-secondary" data-autoselect="" readonly=""><div class="input-group-button"><clipboard-copy value="${url[i]}" aria-label="Copy to clipboard" class="btn btn-sm js-clipboard-copy tooltipped-no-delay ClipboardButton" tabindex="0" role="button">${svg[1]}</clipboard-copy></div></div>`
        }
        html.insertAdjacentHTML('afterend', _html);
    }


    // Git Clone SSH
    function addGitCloneSSH() {
        if (document.querySelector('.XIU2-GCS')) return
        let html = document.querySelector('[role="tabpanel"]:nth-child(3) div.input-group');if (!html) return
        let href_split = html.getElementsByTagName('input')[0].getAttribute('value').split(':'),
            url = [],
            _html = ``;

        if (href_split[0] != 'git@github.com') return

        for (let i=0;i<clone_ssh_url.length;i++){
            url[i] = clone_ssh_url[i][0] + ':' + href_split[1]
        }

        for (let i=0;i<url.length;i++) {
            _html += `<div class="input-group XIU2-GCS" style="margin-top: 4px;" title="åŠ é€Ÿæºï¼š${clone_ssh_url[i][1]} ï¼ˆç‚¹å‡»å¯ç›´æ¥å¤åˆ¶ï¼‰"><input value="${url[i]}" aria-label="${url[i]}" type="text" class="form-control input-monospace input-sm color-bg-secondary" data-autoselect="" readonly=""><div class="input-group-button"><clipboard-copy value="${url[i]}" aria-label="Copy to clipboard" class="btn btn-sm js-clipboard-copy tooltipped-no-delay ClipboardButton" tabindex="0" role="button">${svg[1]}</clipboard-copy></div></div>`
        }
        html.insertAdjacentHTML('afterend', _html);
    }


    // Raw
    function addRawFile() {
        if (document.querySelector('.XIU2-RF')) return
        let html = document.getElementById('raw-url');if (!html) return
        let href = location.href.replace(`https://${location.host}`,''),
            href2 = href.replace('/blob/','/'),
            url = [
                raw_url[1][0] + '/gh' + href.replace('/blob/','@'),
                raw_url[2][0] + href2,
                raw_url[3][0] + '/gh' + href.replace('/blob/','/')
            ],
            _html = ``;
        for (let i=0;i<url.length;i++) {
            _html += `<a href="${url[i]}" title="${raw_url[i+1][2]}" target="_blank" role="button" rel="noreferrer noopener nofollow" class="btn btn-sm BtnGroup-item XIU2-RF">${raw_url[i+1][1]}</a>`
        }
        html.insertAdjacentHTML('afterend', _html);
    }


    // æ·»åŠ  Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰
    function addRawDownLink() {
        // å¦‚æœä¸æ˜¯é¡¹ç›®æ–‡ä»¶é¡µé¢ï¼Œå°±è¿”å›ï¼Œå¦‚æœç½‘é¡µæœ‰ Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰å°±è¿”å›
        let files = document.querySelectorAll('div.Box-row svg.octicon.octicon-file');if(files.length === 0) return;if (location.pathname.indexOf('/tags') > -1) return
        let files1 = document.querySelectorAll('a.fileDownLink');if(files1.length > 0) return;

        // é¼ æ ‡æŒ‡å‘åˆ™æ˜¾ç¤º
        var mouseOverHandler = function(evt) {
            let elem = evt.currentTarget,
                aElm_new = elem.querySelectorAll('.fileDownLink'),
                aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
            aElm_new.forEach(el=>{el.style.cssText = 'display: inline'});
            aElm_now.forEach(el=>{el.style.cssText = 'display: none'});
        };

        // é¼ æ ‡ç¦»å¼€åˆ™éšè—
        var mouseOutHandler = function(evt) {
            let elem = evt.currentTarget,
                aElm_new = elem.querySelectorAll('.fileDownLink'),
                aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
            aElm_new.forEach(el=>{el.style.cssText = 'display: none'});
            aElm_now.forEach(el=>{el.style.cssText = 'display: inline'});
        };

        // å¾ªç¯æ·»åŠ 
        files.forEach(function(fileElm, i) {
            let trElm = fileElm.parentNode.parentNode,
                cntElm_a = trElm.querySelector('.css-truncate.css-truncate-target.d-block.width-fit a'),
                cntElm_svg = trElm.querySelector('.mr-3.flex-shrink-0 svg.octicon.octicon-file'),
                Name = cntElm_a.innerText,
                href = cntElm_a.attributes.href.nodeValue.replace(`https://${location.host}`,'');
            let href2 = href.replace('/blob/','/'), url, url_name, url_tip = '';
            switch(menu_raw_fast) {
                case 0:
                case 2:
                    url = raw_url[menu_raw_fast][0] + href2; break;
                case 1:
                    url = raw_url[menu_raw_fast][0] + '/gh' + href.replace('/blob/','@'); break;
                case 3:
                    url = raw_url[menu_raw_fast][0] + '/gh' + href.replace('/blob/','/'); break;
                default:
                    url = raw_url[menu_raw_fast][0] + '/' + raw_url[0][0] + href2;
            }
            url_name = raw_url[menu_raw_fast][1]; url_tip = raw_url[menu_raw_fast][2];
            let _html = ` <a href="${url}" download="${Name}" target="_blank" rel="noreferrer noopener nofollow" class="fileDownLink" style="display: none;" title="ã€Œ${url_name}ã€&#10;&#10;[Alt + å·¦é”®] æˆ– [å³é”® - å¦å­˜ä¸º...] ä¸‹è½½æ–‡ä»¶ã€‚&#10;æ³¨æ„ï¼šé¼ æ ‡ç‚¹å‡» [â˜] å›¾æ ‡ï¼Œè€Œä¸æ˜¯å·¦ä¾§çš„æ–‡ä»¶åï¼&#10;&#10;${url_tip}æç¤ºï¼šç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’ Tampermonkey æ‰©å±•å›¾æ ‡ - [ ${raw_url[menu_raw_fast][1]} ] åŠ é€Ÿæº (â˜) å³å¯åˆ‡æ¢ã€‚">${svg[2]}</a>`;
            cntElm_svg.insertAdjacentHTML('afterend', _html);
            // ç»‘å®šé¼ æ ‡äº‹ä»¶
            trElm.onmouseover = mouseOverHandler;
            trElm.onmouseout = mouseOutHandler;
        });
    }


    // åˆ é™¤ Raw å¿«æ·ä¸‹è½½ï¼ˆâ˜ï¼‰
    function delRawDownLink() {
        let aElm = document.querySelectorAll('.fileDownLink');if(aElm.length === 0) return;
        aElm.forEach(function(fileElm) {
            fileElm.remove()
        })
    }


    // åœ¨æµè§ˆå™¨è¿”å›/å‰è¿›æ—¶é‡æ–°æ·»åŠ  Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰é¼ æ ‡äº‹ä»¶
    function addRawDownLink_() {
        // å¦‚æœä¸æ˜¯é¡¹ç›®æ–‡ä»¶é¡µé¢ï¼Œå°±è¿”å›ï¼Œå¦‚æœç½‘é¡µæ²¡æœ‰ Raw ä¸‹è½½é“¾æ¥ï¼ˆâ˜ï¼‰å°±è¿”å›
        let files = document.querySelectorAll('div.Box-row svg.octicon.octicon-file');if(files.length === 0) return;
        let files1 = document.querySelectorAll('a.fileDownLink');if(files1.length === 0) return;

        // é¼ æ ‡æŒ‡å‘åˆ™æ˜¾ç¤º
        var mouseOverHandler = function(evt) {
            let elem = evt.currentTarget,
                aElm_new = elem.querySelectorAll('.fileDownLink'),
                aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
            aElm_new.forEach(el=>{el.style.cssText = 'display: inline'});
            aElm_now.forEach(el=>{el.style.cssText = 'display: none'});
        };

        // é¼ æ ‡ç¦»å¼€åˆ™éšè—
        var mouseOutHandler = function(evt) {
            let elem = evt.currentTarget,
                aElm_new = elem.querySelectorAll('.fileDownLink'),
                aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
            aElm_new.forEach(el=>{el.style.cssText = 'display: none'});
            aElm_now.forEach(el=>{el.style.cssText = 'display: inline'});
        };

        // å¾ªç¯æ·»åŠ 
        files.forEach(function(fileElm, i) {
            let trElm = fileElm.parentNode.parentNode;
            // ç»‘å®šé¼ æ ‡äº‹ä»¶
            trElm.onmouseover = mouseOverHandler;
            trElm.onmouseout = mouseOutHandler;
        });
    }


    // è‡ªå®šä¹‰ locationchange äº‹ä»¶ï¼ˆç”¨æ¥ç›‘å¬ URL å˜åŒ–ï¼‰
    function addLocationchange() {
        history.pushState = ( f => function pushState(){
            var ret = f.apply(this, arguments);
            window.dispatchEvent(new Event('pushstate'));
            window.dispatchEvent(new Event('locationchange'));
            return ret;
        })(history.pushState);

        history.replaceState = ( f => function replaceState(){
            var ret = f.apply(this, arguments);
            window.dispatchEvent(new Event('replacestate'));
            window.dispatchEvent(new Event('locationchange'));
            return ret;
        })(history.replaceState);

        window.addEventListener('popstate',()=>{
            window.dispatchEvent(new Event('locationchange'))
        });
    }
})();
